<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>SecureOne | Banco Pichincha</title>

  <style>
    :root{
      --bg:#0b1f3a;
      --card:#0f2a4f;
      --text:#ffffff;
      --muted:rgba(255,255,255,.75);
      --border:rgba(255,255,255,.14);
      --shadow: 0 10px 30px rgba(0,0,0,.28);
      --danger:#b42318;
      --success:#15803d;
      --btn:#ffffff;
      --btnText:#0b1f3a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: linear-gradient(180deg,var(--bg),#08162b);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .wrap{width:100%;max-width:520px}
    .card{
      background:rgba(15,42,79,.92);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:18px;
    }
    h1{margin:0 0 8px;font-size:18px}
    .agencyBox{
      background:rgba(255,255,255,.05);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
    }
    label{font-size:12px;color:var(--muted)}
    input{
      width:100%;
      margin-top:6px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:white;
      font-size:16px;
    }
    .buttons{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:14px;
    }
    button{
      border:none;
      border-radius:14px;
      padding:14px;
      font-weight:800;
      font-size:15px;
      cursor:pointer;
    }
    .open{background:var(--btn);color:var(--btnText)}
    .close{background:rgba(255,255,255,.12);color:white}
    .status{
      margin-top:14px;
      padding:12px;
      border-radius:12px;
      font-size:13px;
      background:rgba(255,255,255,.05);
    }
    .success{background:rgba(21,128,61,.2)}
    .error{background:rgba(180,35,24,.25)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>SecureOne</h1>

      <div class="agencyBox">
        <label>Agencia</label>
        <div id="agency" style="font-weight:800;font-size:16px;margin-top:4px;">--</div>
      </div>

      <label>Clave del día</label>
      <input id="clave" placeholder="Ingresa la clave" />

      <div class="buttons">
        <button class="open" onclick="sendAction('OPEN')">APERTURA</button>
        <button class="close" onclick="confirmClose()">CIERRE</button>
      </div>

      <div id="status" class="status">Listo.</div>
    </div>
  </div>

<script>
const FLOW_URL = "TU_URL_DEL_FLOW_AQUI"; // <-- pega tu URL completa

const params = new URLSearchParams(window.location.search);
const locationId = (params.get("loc") || params.get("agencia") || "").trim();
document.getElementById("agency").textContent = locationId || "No detectada";

function setStatus(message, type){
  const el = document.getElementById("status");
  el.className = "status";
  if(type==="success") el.classList.add("success");
  if(type==="error") el.classList.add("error");
  el.innerHTML = message;
}

function confirmClose(){
  if(confirm("¿Confirmas registrar el CIERRE de esta agencia?")){
    sendAction("CLOSE");
  }
}

async function sendAction(action){
  const clave = document.getElementById("clave").value.trim();

  if(!locationId){
    setStatus("Falta parámetro de agencia en la URL (?loc=ID)", "error");
    return;
  }

  if(!clave){
    setStatus("Ingresa la clave del día.", "error");
    return;
  }

  setStatus("Procesando...", "");

  const payload = {
    locationId: locationId,
    accion: action,
    clave: clave,
    clientTime: new Date().toISOString()
  };

  try{
    const response = await fetch(FLOW_URL,{
      method:"POST",
      headers:{
        "Content-Type":"application/json"
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    if(response.ok && data.ok){
      setStatus("✅ " + (data.message || "Registro exitoso."), "success");
    }else{
      setStatus("❌ " + (data.message || "Operación rechazada."), "error");
    }

  }catch(error){
    setStatus("Error de conexión con el servidor.", "error");
  }
}
</script>

</body>
</html>
